<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta name="theme-color" content="#0B1220" />
    <link rel="manifest" href="/manifest.webmanifest" />
    <title>주도주 탐색기</title>
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <main class="app">
      <div class="top">
        <div class="brand">주도주 탐색기</div>
        <div style="display: flex; align-items: center; gap: 8px;">
          <button id="settingsBtn" class="iconBtn iconBtn--small" aria-label="설정" title="서버 설정">⚙</button>
          <div class="badge badge--warn" id="statusBadge">연결 시도 중…</div>
        </div>
      </div>
      <div class="status" id="statusText">서버에 연결을 시도합니다…</div>
      
      <section class="card card--collapsible" id="serverConfigCard" style="display: none;">
        <div class="card-header" id="serverConfigToggle">
          <h2 class="subtitle">서버 설정</h2>
          <span class="toggle-icon">▼</span>
        </div>
        <div class="card-content" id="serverConfigContent" style="display: none;">
          <div class="row">
            <label class="label" for="serverUrl">서버 URL</label>
            <input type="text" id="serverUrl" class="input" placeholder="https://your-render-app.onrender.com" />
          </div>
          <div class="row">
            <label class="label" for="token">토큰 (선택사항)</label>
            <input type="text" id="token" class="input" placeholder="토큰이 있다면 입력" />
          </div>
          <div class="actions">
            <button id="saveBtn" class="btn">저장</button>
            <button id="refreshBtn" class="btn btn--ghost">수동 갱신</button>
            <button id="clearBtn" class="btn btn--ghost">초기화</button>
          </div>
        </div>
      </section>
      
      <section class="card">
        <h2 class="subtitle">최근 수신</h2>
        <pre id="lastPayload" class="mono">(아직 없음)</pre>
      </section>

      <section class="card card--flush">
        <div class="grid2">
          <div class="ibox">
            <div class="ibox__label">KOSPI</div>
            <div class="ibox__value" id="kospiValue">-</div>
            <div class="ibox__sub" id="kospiSub">-</div>
          </div>
          <div class="ibox">
            <div class="ibox__label">KOSDAQ</div>
            <div class="ibox__value" id="kosdaqValue">-</div>
            <div class="ibox__sub" id="kosdaqSub">-</div>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="sectionHead">
          <h2 class="title">오늘의 주도 테마 (Top 5)</h2>
        </div>
        <div id="themesEmpty" class="empty">현재 시장을 주도하는 뚜렷한 테마가 없습니다. 개별주 장세일 수 있습니다.</div>
        <ul id="themesList" class="list" hidden></ul>
      </section>

      <section class="card">
        <div class="sectionHead">
          <h2 class="title">개별 급등주 / 틈새 공략 (Top 20)</h2>
          <button id="refreshBtn2" class="btn btn--small">데이터 갱신</button>
        </div>

        <div class="tableWrap">
          <table class="table">
            <thead>
              <tr>
                <th>종목명</th>
                <th class="right">현재가</th>
                <th class="right">등락률</th>
                <th class="right">거래대금</th>
                <th class="right">Score</th>
              </tr>
            </thead>
            <tbody id="stocksTbody">
              <tr><td colspan="5" class="muted">데이터를 불러오는 중…</td></tr>
            </tbody>
          </table>
        </div>
      </section>
    </main>

    <dialog id="modal" class="modal">
      <div class="modal__head">
        <div>
          <div class="modal__title" id="mTitle">-</div>
          <div class="modal__sub" id="mSub">-</div>
        </div>
        <button id="mClose" class="iconBtn" aria-label="닫기">×</button>
      </div>
      <div class="modal__body">
        <div class="pillRow" id="mPills"></div>
        <div class="sigList" id="mSignals"></div>
        <a id="mLink" class="link" href="#" target="_blank" rel="noreferrer">네이버 금융에서 더보기</a>
        
        <div class="mini">
          <div class="mini__label">AI 투자 의견 (Beta)</div>
          <div class="mini__box" id="mAi">추후 기존 EXE 로직과 동일하게 연결됩니다.</div>
        </div>
        
        <div class="section" id="mPivotSection" style="display: none;">
          <div class="mini__label">오늘의 단타 가이드 (Pivot)</div>
          <div class="pivotRow" id="mPivot"></div>
        </div>
        
        <div class="section" id="mNewsSection" style="display: none;">
          <div class="mini__label">실시간 뉴스</div>
          <div class="newsList" id="mNews"></div>
        </div>
        
        <div class="section" id="mFinancialSection" style="display: none;">
          <div class="mini__label">재무 요약 (최근 실적)</div>
          <div class="financialTable" id="mFinancial"></div>
        </div>
        
        <div class="section" id="mInvestorSection" style="display: none;">
          <div class="mini__label">투자자별 매매동향 (순매수)</div>
          <div class="investorTable" id="mInvestor"></div>
        </div>
      </div>
    </dialog>

    <script src="/app.js"></script>
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => navigator.serviceWorker.register("/sw.js"));
      }
    </script>
  </body>
</html>


